version: '3'

services:
        spring-app:
                depends_on:
                  - db
                container_name: spring-app
                build:
                        context: ./app
                        dockerfile: ./app/docker/spring.docker
                volumes:
                        - ./:/usr/src/app
                ports:
                        - "8080:80"
                networks:
                        - default
                environment:
                        DB_HOST: spring-db:3306
        eureka-server:
                depends_on:
                        - db
                container_name: eureka-server
                build:
                        context: ./eureka-server
                        dockerfile: ./eureka-server/docker/spring.docker
                volumes:
                        - ./:/usr/src/eureka-server
                networks:
                        - default
                environment:
                        DB_HOST: spring-db:3306
        db:
                container_name: spring-db
                build:
                        context: ./
                        dockerfile: ./app/docker/database.docker
                volumes:
                        - db_data:/var/lib/mysql
                environment:
                        MYSQL_ROOT_PASSWORD: secret
                        MYSQL_DATABASE: springdb
                ports:
                        - "33061:3306"
volumes:
        db_data: